<section class="watch">
  <a href="/" class="back-link" style="display:inline-block;margin:6px 0 4px;color:#98a4c5;font-size:14px">← Kembali</a>

  <h1 class="watch-title" style="display:flex;align-items:center;gap:8px;margin:6px 0 10px">
    <span class="t" style="font-size:36px;font-weight:800;letter-spacing:.3px"><%= v.title %></span>
    <span class="badge-trailer" style="font-size:13px;font-weight:900;letter-spacing:.6px;padding:6px 10px;border-radius:12px;border:1px solid #2b356b;background:rgba(98,120,255,.12)">TRAILER</span>
  </h1>

  <!-- === Adsterra 300x250 (ATAS PLAYER) === -->
  <div class="ad-slot-top" style="border:1px solid #2b356b;border-radius:12px;padding:10px;text-align:center;color:#98a4c5;background:rgba(255,255,255,.03);margin:8px 0 12px">
    <div style="width:300px;height:250px;margin:0 auto">
      <script data-cfasync="false">
        atOptions = { key:'c170db92dbe69cba15f5fe00f341cc59', format:'iframe', height:250, width:300, params:{} };
      </script>
      <script data-cfasync="false" src="//www.highperformanceformat.com/c170db92dbe69cba15f5fe00f341cc59/invoke.js"></script>
    </div>
  </div>

  <!-- PLAYER -->
  <div class="player-shell"
       style="width:100%;max-width:360px;aspect-ratio:16/9;margin:0 auto 12px;border-radius:16px;overflow:hidden;box-shadow:0 0 24px rgba(0,0,0,.35);background:#000;">
    <video controls playsinline preload="metadata" src="<%= v.url %>" style="width:100%;height:100%;background:#000;display:block;border-radius:16px;"></video>
  </div>

  <% if (v.fullUrl) { %>
    <div class="cta-wrap" style="display:flex;justify-content:center;margin:6px 0 8px">
      <a class="btn btn-primary"
         style="display:inline-flex;gap:8px;align-items:center;justify-content:center;padding:12px 16px;border-radius:12px;border:none;background:linear-gradient(90deg,#3a8ef6,#6f3afa);color:#fff;font-weight:700"
         href="<%= v.fullUrl %>" target="_blank" rel="noopener">▶ Tonton FULL</a>
    </div>
  <% } %>

  <!-- === Adsterra 300x250 (BAWAH PLAYER) + fallback === -->
  <div class="ad-banner" style="max-width:680px;margin:16px auto 0;display:flex;flex-direction:column;gap:14px">
    <div class="ad-box" style="border:1px dashed #2b356b;border-radius:12px;padding:10px;text-align:center;color:#98a4c5;background:rgba(255,255,255,.03)">
      <div id="ad-bottom" style="width:300px;height:250px;margin:0 auto;position:relative">
        <script data-cfasync="false">
          (function(){
            var box = document.getElementById('ad-bottom');

            function fallback(){
              box.innerHTML =
                '<a href="/" target="_blank" rel="noopener">' +
                '<img src="/public/ads/backup-300x250.jpg" width="300" height="250" style="display:block;border-radius:8px" alt="Ad"/>' +
                '</a>';
            }

            window.atOptions = { key:'c170db92dbe69cba15f5fe00f341cc59', format:'iframe', height:250, width:300, params:{} };
            var s = document.createElement('script');
            s.setAttribute('data-cfasync','false');
            s.src = '//www.highperformanceformat.com/c170db92dbe69cba15f5fe00f341cc59/invoke.js';
            s.onload = function(){ setTimeout(function(){ if(!box.querySelector('iframe')) fallback(); }, 1800); };
            s.onerror = fallback;
            box.appendChild(s);
          })();
        </script>
      </div>
    </div>
  </div>

  <!-- ====== SHARE LINK (PALING BAWAH) ====== -->
  <div class="share-wrap" style="max-width:680px;margin:18px auto 28px;padding:12px;border:1px solid #2b356b;border-radius:12px;background:rgba(255,255,255,.03)">
    <div style="display:flex;gap:8px;flex-wrap:wrap;align-items:center">
      <input id="share-url" type="text" readonly
             style="flex:1 1 260px;min-width:240px;border:1px solid #2b356b;background:#0e1530;color:#c6d0f5;border-radius:10px;padding:10px 12px;font-size:14px" />
      <button id="btn-copy" type="button"
              style="padding:10px 12px;border-radius:10px;border:1px solid #2b356b;background:#1b2a62;color:#fff;font-weight:700">
        Salin Link
      </button>
      <button id="btn-share" type="button"
              style="padding:10px 12px;border-radius:10px;border:1px solid #2b356b;background:#2b6ef6;color:#fff;font-weight:700">
        Share
      </button>
    </div>
    <small id="share-msg" style="display:block;margin-top:8px;color:#98a4c5"></small>

    <script>
      (function(){
        var url = window.location.href;
        var $input = document.getElementById('share-url');
        var $copy  = document.getElementById('btn-copy');
        var $share = document.getElementById('btn-share');
        var $msg   = document.getElementById('share-msg');

        $input.value = url;

        function flash(text){
          $msg.textContent = text;
          setTimeout(function(){ $msg.textContent=''; }, 1800);
        }

        $copy.addEventListener('click', function(){
          navigator.clipboard && navigator.clipboard.writeText
            ? navigator.clipboard.writeText(url).then(function(){ flash('Link disalin.'); })
            : (function(){
                $input.select(); document.execCommand('copy'); flash('Link disalin.');
              })();
        });

        $share.addEventListener('click', function(){
          if (navigator.share) {
            navigator.share({ title: document.title, text: 'Tonton ini di Shortmovies', url: url })
              .catch(function(){ /* user cancel */ });
          } else {
            // fallback: copy
            $copy.click();
          }
        });
      })();
    </script>
  </div>
</section>
